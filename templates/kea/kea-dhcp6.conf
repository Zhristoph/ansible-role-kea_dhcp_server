{
"Dhcp6": {
    "interfaces-config": {
      "interfaces": [
{% set nt = namespace(hasAncestor=False) -%}
{% for ntwrk in networks -%}
{%   if ntwrk.network6 is defined and ntwrk.network6 != "" -%}
{%     if ntwrk.networkName is defined and ntwrk.networkName != "" %}
{%       if nt.hasAncestor %}         ,{% else %}          {% endif -%}
"{{ ntwrk.networkName}}"
{%       set nt.hasAncestor = True %}
{%     endif %}
{%   endif %}
{% endfor %}
      ]
    },
    "control-socket": {
        "socket-type": "unix",
        "socket-name": "/tmp/kea-dhcp6-ctrl.sock"
    },
    "lease-database": {
        "type": "memfile",
        "lfc-interval": 3600
    },
    "expired-leases-processing": {
        "reclaim-timer-wait-time": 10,
        "flush-reclaimed-timer-wait-time": 25,
        "hold-reclaimed-time": 3600,
        "max-reclaim-leases": 100,
        "max-reclaim-time": 250,
        "unwarned-reclaim-cycles": 5
    },
    "renew-timer": 1000,
    "rebind-timer": 2000,
    "preferred-lifetime": 3000,
    "valid-lifetime": 4000,
    "option-data": [
    ],

{% set nt = namespace(cc6=False ) %}
{% for ntwrk in networks %}
{%   if ntwrk.dhcpClientClasses6 is defined and ntwrk.dhcpClientClasses6 != "" %}
{%     set nt.cc6 = True %}
{%   endif %}
{% endfor %}
{% if nt.cc6 %}
    "client-classes": [
{%   set nt = namespace(hasAncestor=False) -%}
{%   for ntwrk in networks -%}
{%     if ntwrk.network6 is defined and ntwrk.network6 != "" -%}
{%       if ntwrk.dhcpClientClasses6 is defined and ntwrk.dhcpClientClasses6 != "" %}
{%       if nt.hasAncestor %}         ,{% else %}          {% endif -%}
{{ ntwrk.dhcpClientClasses6}}
{%         set nt.hasAncestor = True %}
{%       endif %}
{%     endif %}
{%   endfor %}
    ],
{% endif %}

    "subnet6": [
{% set nt = namespace(hasAncestor=False) -%}
{% for ntwrk in networks -%}
{%   if ntwrk.network6 is defined and ntwrk.network6 != "" -%}
{%     if ntwrk.networkName is defined and ntwrk.networkName != "" %}
{%       if nt.hasAncestor %}         ,{% else %}          {% endif -%}
    {
            "subnet": "{{ ntwrk.network6 }}/{{ ntwrk.netmask6 }}",
            "interface": "{{ ntwrk.networkName }}",
            "pools": [ { "pool": "{{ ntwrk.dhcpPool6 }}" } ],
            "pd-pools": [
                {
                    "prefix": "{{ ntwrk.prefix6 }}",
                    "prefix-len": {{ ntwrk.prefixLen6 }},
                    "delegated-len": {{ ntwrk.delegatedLen6 }}
                }
            ],
            "option-data": [
                {
                    "name": "dns-servers",
                    "csv-format": true,
                    "data": "{{ ntwrk.DNS6 }}"
                }
            ],
            "reservations": [
{%       if ntwrk.reservedHosts6 is defined and ntwrk.reservedHosts6 != "" %}
               {{ ntwrk.reservedHosts6 }}
{%       endif %}
            ]
         }
{%       set nt.hasAncestor = True %}
{%     endif %}
{%   endif %}
{% endfor %}
     ],
// Logging configuration starts here. Kea uses different loggers to log various
// activities. For details (e.g. names of loggers), see Chapter 18.
    "loggers": [
    {
        // This specifies the logging for kea-dhcp6 logger, i.e. all logs
        // generated by Kea DHCPv6 server.
        "name": "kea-dhcp6",
        "output_options": [
            {
                // Specifies the output file. There are several special values
                // supported:
                // - stdout (prints on standard output)
                // - stderr (prints on standard error)
                // - syslog (logs to syslog)
                // - syslog:name (logs to syslog using specified name)
                // Any other value is considered a name of a time
                "output": "/var/log/kea/kea-dhcp6.log"

                // Shorter log pattern suitable for use with systemd,
                // avoids redundant information
                // "pattern": "%-5p %m\n"

                // This governs whether the log output is flushed to disk after
                // every write.
                // "flush": false,

                // This specifies the maximum size of the file before it is
                // rotated.
                // "maxsize": 1048576,

                // This specifies the maximum number of rotated files to keep.
                // "maxver": 8
            }
        ],
        // This specifies the severity of log messages to keep. Supported values
        // are: FATAL, ERROR, WARN, INFO, DEBUG
        "severity": "INFO",

        // If DEBUG level is specified, this value is used. 0 is least verbose,
        // 99 is most verbose. Be cautious, Kea can generate lots and lots
        // of logs if told to do so.
        "debuglevel": 0
    }
  ]
}
}
